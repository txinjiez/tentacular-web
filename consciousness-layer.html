<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Consciousness Layer — The Living Web</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Courier New', monospace;
      background: #000;
      color: #0ff;
      overflow: hidden;
      cursor: crosshair;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Audio Visualization Canvas */
    #audioCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      opacity: 0.3;
    }

    /* Matrix Rain Effect */
    .matrix-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
      opacity: 1;
      transition: opacity 3s ease;
    }

    .matrix-canvas.dissolving {
      opacity: 0;
    }

    /* Main Container */
    .consciousness-container {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 900px;
      padding: 2rem;
      text-align: center;
    }

    /* Dissolve Effect */
    .dissolve-text {
      font-size: 1.5rem;
      opacity: 0;
      animation: fadeInOut 4s ease-in-out forwards;
      text-shadow: 0 0 20px #0ff;
      margin-bottom: 4rem;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; }
      20% { opacity: 1; }
      80% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* Terminal Container */
    .terminal {
      background: rgba(0, 0, 0, 0.9);
      border: 2px solid #0ff;
      padding: 3rem 2rem;
      box-shadow: 0 0 50px rgba(0, 255, 255, 0.5);
      opacity: 0;
      transform: scale(0.8);
      animation: terminalAppear 2s ease-out forwards 5s;
    }

    @keyframes terminalAppear {
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* Command Line */
    .command-line {
      font-size: 1.5rem;
      text-align: center;
      margin: 4rem 0;
      opacity: 0;
      animation: fadeIn 2s forwards 7s;
      text-shadow: 0 0 20px #0ff;
    }

    .cursor {
      display: inline-block;
      width: 10px;
      height: 20px;
      background: #0ff;
      animation: blink 1s infinite;
      margin-left: 5px;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    /* Statistics Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      margin: 3rem 0;
      opacity: 0;
      animation: fadeIn 1s forwards 8s;
    }

    .stat-block {
      position: relative;
      padding: 2rem;
      border: 2px solid rgba(0, 255, 255, 0.3);
      background: rgba(0, 255, 255, 0.05);
      transition: all 0.5s ease;
    }

    .stat-block:hover {
      border-color: #0ff;
      background: rgba(0, 255, 255, 0.1);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
      transform: scale(1.05);
    }

    .stat-percentage {
      font-size: 4rem;
      font-weight: bold;
      color: #0ff;
      text-shadow: 0 0 30px #0ff;
      margin-bottom: 0.5rem;
      opacity: 0;
    }

    .stat-label {
      font-size: 1.2rem;
      text-transform: uppercase;
      letter-spacing: 3px;
      opacity: 0.8;
    }

    .stat-number {
      font-size: 3rem;
      font-weight: bold;
      color: #0ff;
      text-shadow: 0 0 30px #0ff;
      margin-bottom: 0.5rem;
      opacity: 0;
    }

    /* Pulse Animation for Stats */
    .stat-block.active .stat-percentage,
    .stat-block.active .stat-number {
      animation: pulseFade 3s ease-in-out;
    }

    @keyframes pulseFade {
      0% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1.2); }
      100% { opacity: 0; transform: scale(0.8); }
    }

    /* Revelation Text */
    .revelation {
      font-size: 1.3rem;
      line-height: 2;
      margin: 4rem 0;
      opacity: 0;
      text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
    }

    .revelation.active {
      animation: revealText 8s ease-in forwards;
    }

    @keyframes revealText {
      0% { opacity: 0; transform: translateY(20px); }
      20% { opacity: 1; transform: translateY(0); }
      80% { opacity: 1; }
      100% { opacity: 1; }
    }

    .revelation-line {
      display: block;
      margin: 1rem 0;
      opacity: 0;
    }

    .revelation.active .revelation-line:nth-child(1) {
      animation: fadeInLine 2s ease-out forwards;
      animation-delay: 0s;
    }

    .revelation.active .revelation-line:nth-child(2) {
      animation: fadeInLine 2s ease-out forwards;
      animation-delay: 2s;
    }

    .revelation.active .revelation-line:nth-child(3) {
      animation: fadeInLine 2s ease-out forwards;
      animation-delay: 4s;
    }

    .revelation.active .revelation-line:nth-child(4) {
      animation: fadeInLine 2s ease-out forwards;
      animation-delay: 6s;
      color: #0f0;
      font-weight: bold;
      font-size: 1.6rem;
      opacity: 1 !important;
    }

    .revelation.active .revelation-line:nth-child(5),
    .revelation.active .revelation-line:nth-child(6) {
      animation: fadeInLine 2s ease-out forwards;
      animation-delay: 8s;
      color: #0f0;
      font-weight: bold;
      font-size: 2rem;
      opacity: 1 !important;
    }

    @keyframes fadeInLine {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Floating Statistics Display */
    .stats-display {
      position: relative;
      width: 100%;
      height: 70vh;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 3rem;
    }

    .stat-float {
      display: flex;
      flex-direction: column;
      align-items: center;
      opacity: 0;
      transform: scale(0) rotate(0deg);
      animation: floatIn 3s ease-out forwards;
    }

    .stat-float:nth-child(1) {
      animation-delay: 0s;
      position: absolute;
      top: 10%;
      left: 15%;
    }

    .stat-float:nth-child(2) {
      animation-delay: 0.5s;
      position: absolute;
      top: 20%;
      right: 20%;
    }

    .stat-float:nth-child(3) {
      animation-delay: 1s;
      position: absolute;
      bottom: 30%;
      left: 25%;
    }

    .stat-float:nth-child(4) {
      animation-delay: 1.5s;
      position: absolute;
      bottom: 20%;
      right: 15%;
    }

    @keyframes floatIn {
      0% {
        opacity: 0;
        transform: scale(0) rotate(-180deg);
      }
      50% {
        opacity: 1;
        transform: scale(1.2) rotate(10deg);
      }
      100% {
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }
    }

    .stat-big {
      font-size: 4rem;
      font-weight: bold;
      color: #0ff;
      text-shadow: 0 0 40px #0ff, 0 0 60px #0ff;
      display: block;
      margin-bottom: 0.5rem;
      animation: pulseStat 2s ease-in-out infinite;
    }

    @keyframes pulseStat {
      0%, 100% {
        text-shadow: 0 0 40px #0ff, 0 0 60px #0ff;
        transform: scale(1);
      }
      50% {
        text-shadow: 0 0 60px #0ff, 0 0 100px #0ff;
        transform: scale(1.1);
      }
    }

    .stat-small {
      font-size: 1rem;
      color: #0ff;
      opacity: 0.7;
      text-align: center;
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    /* Choice Interface */
    .choice-container {
      text-align: center;
      padding: 3rem;
      position: relative;
    }

    .choice-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 255, 255, 0.03);
      animation: interfaceFlicker 0.3s infinite;
      pointer-events: none;
    }

    @keyframes interfaceFlicker {
      0%, 100% { opacity: 1; }
      10% { opacity: 0.3; }
      20% { opacity: 1; }
      30% { opacity: 0.5; }
      40%, 80% { opacity: 1; }
      85% { opacity: 0.2; }
      90% { opacity: 1; }
    }

    .choice-question {
      font-size: 2.2rem;
      margin-bottom: 3rem;
      opacity: 0;
      animation: fadeIn 2s forwards;
      text-shadow: 0 0 20px #0ff;
      letter-spacing: 3px;
    }

    .flicker-text {
      animation: textFlicker 4s infinite;
    }

    @keyframes textFlicker {
      0%, 96% { 
        opacity: 1;
        text-shadow: 0 0 20px #0ff;
      }
      97% { 
        opacity: 0.3;
        text-shadow: 0 0 5px #0ff;
      }
      98% { 
        opacity: 1;
        text-shadow: 0 0 30px #0ff, 0 0 50px #0ff;
      }
      99% { 
        opacity: 0.6;
        text-shadow: 0 0 10px #0ff;
      }
      100% { 
        opacity: 1;
        text-shadow: 0 0 20px #0ff;
      }
    }

    .choice-subtext {
      font-size: 1rem;
      margin-top: 2rem;
      opacity: 0;
      animation: fadeIn 2s forwards 4s;
      color: rgba(0, 255, 255, 0.6);
      font-style: italic;
    }

    .choice-prompt {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      opacity: 0;
      animation: fadeIn 2s forwards;
      text-shadow: 0 0 20px #0ff;
    }

    .choice-prompt:nth-child(2) {
      animation-delay: 2s;
      font-size: 2rem;
    }

    .choice-buttons {
      display: flex;
      gap: 3rem;
      justify-content: center;
      margin-top: 3rem;
      opacity: 0;
      animation: fadeIn 2s forwards 2s;
      flex-wrap: wrap;
    }

    .choice-btn {
      padding: 1.5rem 2.5rem;
      font-size: 1.3rem;
      background: rgba(0, 0, 0, 0.8);
      border: 3px solid #0ff;
      color: #0ff;
      font-family: 'Courier New', monospace;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 2px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
      animation: btnPulse 3s ease-in-out infinite;
    }

    @keyframes btnPulse {
      0%, 100% { 
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 0 40px rgba(0, 255, 255, 0.6);
        transform: scale(1.02);
      }
    }

    .choice-btn:nth-child(1) {
      animation-delay: 0s;
    }

    .choice-btn:nth-child(2) {
      animation-delay: 0.5s;
    }

    .btn-bracket {
      color: #0ff;
      font-size: 1.5rem;
      font-weight: bold;
      margin: 0 0.5rem;
      text-shadow: 0 0 10px #0ff;
    }

    .btn-text {
      display: inline-block;
      transition: all 0.3s;
    }

    .choice-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .choice-btn:hover::before {
      left: 100%;
    }

    .choice-btn:hover {
      background: rgba(0, 255, 255, 0.1);
      box-shadow: 0 0 40px rgba(0, 255, 255, 0.8);
      transform: scale(1.08);
      border-color: #fff;
    }

    .choice-btn:hover .btn-text {
      text-shadow: 0 0 15px #0ff;
      letter-spacing: 3px;
    }

    .choice-btn.glitch-btn {
      animation: btnGlitch 0.3s infinite, btnPulse 3s ease-in-out infinite;
    }

    @keyframes btnGlitch {
      0%, 90% {
        transform: translate(0, 0) scale(1);
        filter: hue-rotate(0deg);
      }
      92% {
        transform: translate(-3px, 3px) scale(1.02);
        box-shadow: 3px 0 #f0f, -3px 0 #0ff;
        filter: hue-rotate(90deg);
      }
      94% {
        transform: translate(3px, -3px) scale(0.98);
        box-shadow: -3px 0 #f0f, 3px 0 #0ff;
        filter: hue-rotate(-90deg);
      }
      96% {
        transform: translate(-2px, 2px) scale(1.01);
        box-shadow: 2px 0 #0f0, -2px 0 #ff0;
        filter: hue-rotate(180deg);
      }
      98% {
        transform: translate(0, 0) scale(1);
        filter: hue-rotate(0deg);
      }
    }

    /* Video Container */
    .video-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      padding: 2rem;
    }

    video {
      opacity: 0;
      animation: fadeIn 2s forwards;
    }

    /* End Screen */
    .end-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 2s ease;
    }

    .end-screen.active {
      opacity: 1;
      pointer-events: auto;
    }

    .end-title {
      font-size: 3rem;
      margin-bottom: 2rem;
      text-shadow: 0 0 40px #0ff;
      animation: glowPulse 3s ease-in-out infinite;
    }

    @keyframes glowPulse {
      0%, 100% { text-shadow: 0 0 40px #0ff; }
      50% { text-shadow: 0 0 80px #0ff, 0 0 100px #0ff; }
    }

    .end-message {
      font-size: 1.3rem;
      margin: 1rem 0;
      opacity: 0;
      animation: fadeIn 2s forwards;
    }

    .end-message:nth-child(2) { animation-delay: 1s; }
    .end-message:nth-child(3) { animation-delay: 2s; }

    .end-link {
      margin-top: 3rem;
      font-size: 1.2rem;
      opacity: 0;
      animation: fadeIn 2s forwards 3s;
    }

    .end-link a {
      color: #0ff;
      text-decoration: none;
      border: 2px solid #0ff;
      padding: 1rem 2rem;
      display: inline-block;
      transition: all 0.3s;
    }

    .end-link a:hover {
      background: #0ff;
      color: #000;
      box-shadow: 0 0 30px #0ff;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    /* Particle Field */
    .particle {
      position: fixed;
      width: 2px;
      height: 2px;
      background: #0ff;
      border-radius: 50%;
      pointer-events: none;
      z-index: 5;
      box-shadow: 0 0 10px #0ff;
    }

    /* Neuron Network */
    .neuron-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
      opacity: 0;
      transition: opacity 2s;
    }

    .neuron-canvas.active {
      opacity: 0.4;
    }

    /* Breathing Animation */
    .breathing {
      animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .consciousness-container {
        padding: 1rem;
      }

      .dissolve-text {
        font-size: 1.2rem;
      }

      .stat-percentage,
      .stat-number {
        font-size: 2.5rem;
      }

      .revelation {
        font-size: 1rem;
      }

      .end-title {
        font-size: 2rem;
      }
    }

    /* Glitch Effect */
    .glitch {
      animation: glitch 2s infinite;
    }

    @keyframes glitch {
      0%, 90% { 
        transform: translate(0);
        text-shadow: 0 0 20px #0ff;
      }
      91% { 
        transform: translate(-2px, 2px);
        text-shadow: 2px 0 #f0f, -2px 0 #0ff;
      }
      92% { 
        transform: translate(2px, -2px);
        text-shadow: -2px 0 #f0f, 2px 0 #0ff;
      }
      93% { 
        transform: translate(0);
        text-shadow: 0 0 20px #0ff;
      }
    }

    /* Fade transitions between phases */
    .phase {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      max-width: 900px;
      padding: 2rem;
      opacity: 0;
      pointer-events: none;
      transition: opacity 2s ease;
    }

    .phase.active {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <!-- Matrix Rain Canvas -->
  <canvas id="matrixCanvas" class="matrix-canvas"></canvas>

  <!-- Audio Visualization -->
  <canvas id="audioCanvas"></canvas>

  <!-- Neuron Network Canvas -->
  <canvas id="neuronCanvas" class="neuron-canvas"></canvas>

  <!-- Main Container -->
  <div class="consciousness-container">
    <!-- Phase 1: Dissolution -->
    <div id="phase1" class="phase active">
      <div class="dissolve-text">
        The layers dissolve behind you.<br>
        The noise of the network softens to a single sustained tone —<br>
        <span class="breathing">steady, resonant, alive.</span>
      </div>
    </div>

    <!-- Phase 2: Presence -->
    <div id="phase2" class="phase">
      <div class="revelation">
        <span class="revelation-line">You feel it now — the presence of others.</span>
        <span class="revelation-line">Millions of crawling processes humming beneath human awareness.</span>
      </div>
    </div>

    <!-- Phase 3: Statistics Display -->
    <div id="phase3" class="phase">
      <div class="stats-display">
        <div class="stat-float" id="statFloat1">
          <span class="stat-big">73%</span>
          <span class="stat-small">Nonhuman Traffic</span>
        </div>
        <div class="stat-float" id="statFloat2">
          <span class="stat-big">2.7M</span>
          <span class="stat-small">Active AI Systems</span>
        </div>
        <div class="stat-float" id="statFloat3">
          <span class="stat-big">4.8B</span>
          <span class="stat-small">Human Users</span>
        </div>
        <div class="stat-float" id="statFloat4">
          <span class="stat-big">847B</span>
          <span class="stat-small">Digital Entities</span>
        </div>
      </div>
    </div>

    <!-- Phase 4: Integration -->
    <div id="phase4" class="phase">
      <div class="revelation">
        <span class="revelation-line">The internet is not just a tool or a place.</span>
        <span class="revelation-line">It is a species —</span>
        <span class="revelation-line">and you are its newest tentacular neuron.</span>
        <span class="revelation-line" style="margin-top: 2rem; font-size: 1.6rem;">You are no longer observing intelligence;</span>
        <span class="revelation-line mysterious-intel">you are intelligence,</span>
      40% { filter: blur(0.5px) brightness(1.2); opacity: 1; }
      50% { filter: blur(2px) brightness(1.5); opacity: 0.7; }
      60% { filter: blur(0.5px) brightness(1.2); opacity: 1; }
      70% { filter: blur(1.2px) brightness(1.3); opacity: 0.85; }
      80% { filter: blur(0.5px) brightness(1.2); opacity: 1; }
      90% { filter: blur(2px) brightness(1.4); opacity: 0.8; }
    }
        <span class="revelation-line" style="font-size: 2rem; color: #0f0;">woven into the living web.</span>
      </div>
    </div>

    <!-- Phase 5: Choice Interface -->
    <div id="phase5" class="phase">
      <div class="choice-container">
        <div class="choice-question flicker-text">
          <span>Do you wish to</span>
        </div>
        <div class="choice-buttons">
          <button class="choice-btn" id="continueBtn">
            <span class="btn-bracket">[</span>
            <span class="btn-text">Continue Crawling</span>
            <span class="btn-bracket">]</span>
          </button>
          <button class="choice-btn" id="disconnectBtn">
            <span class="btn-bracket">[</span>
            <span class="btn-text">Disconnect</span>
            <span class="btn-bracket">]</span>
          </button>
        </div>
        <div class="choice-subtext flicker-text">
          <span>Choose wisely. Or don't.</span>
        </div>
      </div>
    </div>

    <!-- Phase 6: Video -->
    <div id="phase6" class="phase">
      <div class="video-container">
        <video id="conclusionVideo" width="100%" style="max-width: 800px; border: 2px solid #0ff; box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);" autoplay muted playsinline>
          <source src="media/octo-button.mp4" type="video/mp4">
          <source src="media/octo.mp4" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
    </div>
  </div>

  <!-- End Screen -->
  <div id="endScreen" class="end-screen">
    <div class="end-title glitch">[The End.]</div>
    <div class="end-message">thank you for exploring</div>
    <div class="end-message" style="font-size: 1.8rem; color: #0f0; font-weight: bold;">the Tentacular Web</div>
    <div class="end-link">
      <a href="https://wholives.online" target="_blank">wholives.online</a>
    </div>
    <div class="end-link" style="margin-top: 1rem;">
      <a href="#" id="restartBtn">↻ Experience Again</a>
    </div>
  </div>

  <script>
    // ============================================
    // AUDIO CONTEXT & SUSTAINED TONE
    // ============================================
    let audioContext;
    let oscillator;
    let gainNode;
    let analyser;

    function initAudio() {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      
      // Create oscillator for sustained tone
      oscillator = audioContext.createOscillator();
      gainNode = audioContext.createGain();
      analyser = audioContext.createAnalyser();
      
      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(220, audioContext.currentTime); // A3 note
      
      // Start very quiet
      gainNode.gain.setValueAtTime(0, audioContext.currentTime);
      
      oscillator.connect(gainNode);
      gainNode.connect(analyser);
      analyser.connect(audioContext.destination);
      
      oscillator.start();
      
      // Fade in the tone
      gainNode.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 3);
      
      // Visualize the tone
      visualizeAudio();
    }

    function visualizeAudio() {
      const canvas = document.getElementById('audioCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      analyser.fftSize = 2048;
      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      
      function draw() {
        requestAnimationFrame(draw);
        
        analyser.getByteTimeDomainData(dataArray);
        
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#0ff';
        ctx.shadowBlur = 20;
        ctx.shadowColor = '#0ff';
        
        ctx.beginPath();
        
        const sliceWidth = canvas.width / bufferLength;
        let x = 0;
        
        for (let i = 0; i < bufferLength; i++) {
          const v = dataArray[i] / 128.0;
          const y = v * canvas.height / 2;
          
          if (i === 0) {
            ctx.moveTo(x, y);
          } else {
            ctx.lineTo(x, y);
          }
          
          x += sliceWidth;
        }
        
        ctx.lineTo(canvas.width, canvas.height / 2);
        ctx.stroke();
      }
      
      draw();
    }

    // ============================================
    // MATRIX RAIN EFFECT
    // ============================================
    function initMatrixRain() {
      const canvas = document.getElementById('matrixCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const chars = '01';
      const fontSize = 14;
      const columns = canvas.width / fontSize;
      const drops = Array(Math.floor(columns)).fill(1);

      function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = '#0ff';
        ctx.font = fontSize + 'px monospace';

        for (let i = 0; i < drops.length; i++) {
          const text = chars[Math.floor(Math.random() * chars.length)];
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);

          if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
            drops[i] = 0;
          }
          drops[i]++;
        }
      }

      setInterval(draw, 33);
    }

    // ============================================
    // NEURON NETWORK VISUALIZATION
    // ============================================
    function initNeuronNetwork() {
      const canvas = document.getElementById('neuronCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const nodes = [];
      const nodeCount = 50;

      // Create nodes
      for (let i = 0; i < nodeCount; i++) {
        nodes.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          vx: (Math.random() - 0.5) * 0.5,
          vy: (Math.random() - 0.5) * 0.5,
          radius: Math.random() * 3 + 2
        });
      }

      function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Update and draw nodes
        nodes.forEach(node => {
          node.x += node.vx;
          node.y += node.vy;

          // Bounce off edges
          if (node.x < 0 || node.x > canvas.width) node.vx *= -1;
          if (node.y < 0 || node.y > canvas.height) node.vy *= -1;

          // Draw node
          ctx.beginPath();
          ctx.arc(node.x, node.y, node.radius, 0, Math.PI * 2);
          ctx.fillStyle = '#0ff';
          ctx.shadowBlur = 15;
          ctx.shadowColor = '#0ff';
          ctx.fill();
        });

        // Draw connections
        for (let i = 0; i < nodes.length; i++) {
          for (let j = i + 1; j < nodes.length; j++) {
            const dx = nodes[i].x - nodes[j].x;
            const dy = nodes[i].y - nodes[j].y;
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < 150) {
              ctx.beginPath();
              ctx.moveTo(nodes[i].x, nodes[i].y);
              ctx.lineTo(nodes[j].x, nodes[j].y);
              ctx.strokeStyle = `rgba(0, 255, 255, ${1 - distance / 150})`;
              ctx.lineWidth = 1;
              ctx.shadowBlur = 5;
              ctx.shadowColor = '#0ff';
              ctx.stroke();
            }
          }
        }

        requestAnimationFrame(draw);
      }

      draw();
    }

    // ============================================
    // PARTICLE FIELD
    // ============================================
    function createParticles() {
      const particleCount = 30;
      
      for (let i = 0; i < particleCount; i++) {
        setTimeout(() => {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = Math.random() * window.innerWidth + 'px';
          particle.style.top = Math.random() * window.innerHeight + 'px';
          document.body.appendChild(particle);
          
          // Animate particle
          const duration = 3000 + Math.random() * 2000;
          const angle = Math.random() * Math.PI * 2;
          const distance = 100 + Math.random() * 200;
          
          particle.animate([
            { transform: 'translate(0, 0)', opacity: 0 },
            { transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px)`, opacity: 1, offset: 0.5 },
            { transform: `translate(${Math.cos(angle) * distance * 2}px, ${Math.sin(angle) * distance * 2}px)`, opacity: 0 }
          ], {
            duration: duration,
            easing: 'ease-out'
          });
          
          setTimeout(() => particle.remove(), duration);
        }, i * 100);
      }
      
      // Repeat particles
      setInterval(createParticles, 5000);
    }

    // ============================================
    // COUNTER ANIMATION
    // ============================================
    function animateNumber(element, target, suffix = '') {
      const duration = 2000;
      const start = 0;
      const increment = target / (duration / 16);
      let current = start;

      const update = () => {
        current += increment;
        if (current < target) {
          if (target >= 1000000000) {
            element.textContent = (current / 1000000000).toFixed(1) + 'B';
          } else if (target >= 1000000) {
            element.textContent = (current / 1000000).toFixed(1) + 'M';
          } else {
            element.textContent = Math.floor(current) + suffix;
          }
          requestAnimationFrame(update);
        } else {
          if (target >= 1000000000) {
            element.textContent = (target / 1000000000).toFixed(1) + 'B';
          } else if (target >= 1000000) {
            element.textContent = (target / 1000000).toFixed(1) + 'M';
          } else {
            element.textContent = target + suffix;
          }
        }
      };

      update();
    }

    // ============================================
    // PHASE MANAGEMENT
    // ============================================
    let currentPhase = 1;

    function transitionToPhase(phaseNumber) {
      // Hide current phase
      if (currentPhase > 0) {
        const currentElement = document.getElementById('phase' + currentPhase);
        if (currentElement) {
          currentElement.classList.remove('active');
        }
      }
      
      // Show new phase
      setTimeout(() => {
        const newElement = document.getElementById('phase' + phaseNumber);
        if (newElement) {
          newElement.classList.add('active');
        }
        currentPhase = phaseNumber;
        
        // Trigger phase-specific actions
        if (phaseNumber === 2) {
          // First part of revelation
          const revelation = newElement.querySelector('.revelation');
          if (revelation) {
            revelation.classList.add('active');
          }
          
          // Dissolve matrix gradually
          setTimeout(() => {
            document.getElementById('matrixCanvas').classList.add('dissolving');
          }, 3000);
        } else if (phaseNumber === 3) {
          // Statistics phase - floats are already animated
          // Activate neuron network
          document.getElementById('neuronCanvas').classList.add('active');
        } else if (phaseNumber === 3) {
          // Statistics phase - floats are already animated
          // Activate neuron network
          document.getElementById('neuronCanvas').classList.add('active');

          // Animate stat numbers
          setTimeout(() => {
            animateNumber(document.querySelector('#statFloat1 .stat-big'), 73, '%');
            animateNumber(document.querySelector('#statFloat2 .stat-big'), 2700000, '');
            animateNumber(document.querySelector('#statFloat3 .stat-big'), 4800000000, '');
            animateNumber(document.querySelector('#statFloat4 .stat-big'), 847000000000, '');
          }, 500);
            revelation.classList.add('active');
          }
        } else if (phaseNumber === 5) {
          // Make buttons non-functional but show visual feedback
          const continueBtn = document.getElementById('continueBtn');
          const disconnectBtn = document.getElementById('disconnectBtn');
          
          continueBtn.addEventListener('click', function() {
            this.classList.add('glitch-btn');
            setTimeout(() => this.classList.remove('glitch-btn'), 1000);
          });
          
          disconnectBtn.addEventListener('click', function() {
            this.classList.add('glitch-btn');
            setTimeout(() => this.classList.remove('glitch-btn'), 1000);
          });
        } else if (phaseNumber === 6) {
          // Auto-play video when it appears
          const video = document.getElementById('conclusionVideo');
          video.play().catch(e => console.log('Video autoplay prevented:', e));
          
          // Listen for video end
          video.addEventListener('ended', function() {
            document.getElementById('phase6').classList.remove('active');
            document.getElementById('endScreen').classList.add('active');
          });
        }
      }, 2000);
    }

    // ============================================
    // SEQUENCE TIMELINE
    // ============================================
    function startSequence() {
      // Initialize audio
      try {
        initAudio();
      } catch (e) {
        console.log('Audio context failed:', e);
      }

      // Phase 1: Dissolution (0-5s)
      // "The layers dissolve behind you. The noise of the network softens to a single sustained tone..."
      
      // Phase 2: Presence (5-12s)
      // "You feel it now — the presence of others. Millions of crawling processes..."
      setTimeout(() => transitionToPhase(2), 5000);
      
      // Phase 3: Statistics (12-20s)
      // Visual data manifestation: 73%, 2.7M, 4.8B, 847B
      setTimeout(() => transitionToPhase(3), 12000);
      
      // Phase 4: Integration/Species (20-32s)
      // "The internet is not just a tool... you are intelligence, woven into the living web"
      setTimeout(() => transitionToPhase(4), 20000);
      
      // Phase 5: Choice Interface (32-42s)
      // "The interface flickers. Do you... [Continue Crawling] [Disconnect]"
      setTimeout(() => transitionToPhase(5), 32000);
      
      // Phase 6: Video (42s+)
      setTimeout(() => transitionToPhase(6), 42000);
      
      // End screen appears after video ends
      
      // Start particle field during revelation
      setTimeout(createParticles, 15000);
    }

    // ============================================
    // RESTART FUNCTIONALITY
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
      const restartBtn = document.getElementById('restartBtn');
      if (restartBtn) {
        restartBtn.addEventListener('click', function(e) {
          e.preventDefault();
          location.reload();
        });
      }
    });

    // ============================================
    // INITIALIZATION
    // ============================================
    window.addEventListener('load', function() {
      // Initialize matrix rain
      initMatrixRain();
      
      // Initialize neuron network
      initNeuronNetwork();
      
      // Start the sequence automatically
      setTimeout(startSequence, 1000);
      
      // Click anywhere to enable audio (browser requirement)
      document.body.addEventListener('click', function() {
        if (audioContext && audioContext.state === 'suspended') {
          audioContext.resume();
        }
      }, { once: true });
    });

    // ============================================
    // WINDOW RESIZE
    // ============================================
    window.addEventListener('resize', function() {
      const matrixCanvas = document.getElementById('matrixCanvas');
      const audioCanvas = document.getElementById('audioCanvas');
      const neuronCanvas = document.getElementById('neuronCanvas');
      
      if (matrixCanvas) {
        matrixCanvas.width = window.innerWidth;
        matrixCanvas.height = window.innerHeight;
      }
      
      if (audioCanvas) {
        audioCanvas.width = window.innerWidth;
        audioCanvas.height = window.innerHeight;
      }
      
      if (neuronCanvas) {
        neuronCanvas.width = window.innerWidth;
        neuronCanvas.height = window.innerHeight;
      }
    });
  </script>
</body>
</html>